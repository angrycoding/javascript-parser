<!DOCTYPE HTML>
<html>
	<head>
		<title>krang</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<script type="text/javascript" src="beautify.js"></script>
		<script type="text/javascript" src="krang.js"></script>

		<script id="script" type="text/plain">

			var CDATA = <![CDATA[
				hello
				world
				2 x 2 = 4
			]]>;

			alert(CDATA);

			var widgetCSS = <style type="text/css">
				.item {
					margin-bottom: 5px;
					border-radius: 6px;
					border: 1px solid red;
				}
			</style>;

			alert(widgetCSS);

			document.body.appendChild(widgetCSS);

			var f = document.createElement('a');
			f.setAttribute('href', 'http://www.google.com/');
			f.setAttribute('target', '_blank');
			f.innerHTML = 'google';
			document.body.appendChild(f);

			var x = <div class="item">

					foo: <strong>bar</strong>
					<input type="button" value="Кнопка" onclick="alert(1);" />
					<textarea><![CDATA[
						<div>XXXX</div>
					]]></textarea>
				</div>;

			for (var c = 0; c < 3; c++) {
				document.body.appendChild(x.cloneNode(true));
			}


		</script>

		<script type="text/javascript">

			// var x = /

			function dump(value) {
				console.info(
					js_beautify(
						JSON.stringify(
							value,
							function(x, y) {
								if (typeof y === 'function')
									return y.toString()
								return y
							}
						)
					)
				);
			}


			var script = document.getElementById('script').innerHTML;

			krang({cache: false, debug: false}).require([
				'src/parser/Parser',
				'src/Generator',
				'src/evaluator/Evaluator'
			], function(Parser, Generator, Evaluator) {

				var AST = Parser(script);
				dump(AST);
				// console.info(Generator(AST));

				Evaluator(AST, function(result) {
					console.info('DONE EVALUATION', result);
				});

			});

		</script>


	</head>
	<body>

	</body>
</html>